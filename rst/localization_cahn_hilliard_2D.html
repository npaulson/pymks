
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Cahn-Hilliard Example &mdash; PyMKS</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.3.6/cosmo/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pymks.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.3.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../_static/pymks_logo.ico"/>
    <link rel="top" title="PyMKS" href="../index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">


  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><img src="../_static/pymks_logo.png">
          PyMKS</a>
        <span class="navbar-text navbar-version pull-left"><b>0.3.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="INSTALLATION.html">Installation</a></li>
                <li><a href="../EXAMPLES.html">Examples</a></li>
                <li><a href="../API.html">API</a></li>
                <li><a href="https://github.com/materialsinnovation/pymks/">Github</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">More <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../THEORY.html">Theory</a><ul>
<li class="toctree-l2"><a class="reference internal" href="derivation.html">Derivation of MKS Localization Equation</a></li>
<li class="toctree-l2"><a class="reference internal" href="tech_overview.html">Technical Overview</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="CREDITS.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="LICENSE.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="CITATION.html">Citing</a></li>
<li class="toctree-l1"><a class="reference internal" href="REQUIREMENTS.html">Requirements</a></li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          

        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="cahn-hilliard-example">
<h1>Cahn-Hilliard Example<a class="headerlink" href="#cahn-hilliard-example" title="Permalink to this headline">¶</a></h1>
<p>This example demonstrates how to use PyMKS to solve the Cahn-Hilliard
equation. The first section provides some background information about
the Cahn-Hilliard equation as well as details about calibrating and
validating the MKS model. The example demonstrates how to generate
sample data, calibrate the influence coefficients and then pick an
appropriate number of local states when state space is continuous. The
MKS model and a spectral solution of the Cahn-Hilliard equation are
compared on a larger test microstructure over multiple time steps.</p>
<div class="section" id="cahn-hilliard-equation">
<h2>Cahn-Hilliard Equation<a class="headerlink" href="#cahn-hilliard-equation" title="Permalink to this headline">¶</a></h2>
<p>The Cahn-Hilliard equation is used to simulate microstructure evolution
during spinodial decomposition and has the following form,</p>
<div class="math">
\[\dot{\phi} = \nabla^2 \left( \phi^3 - \phi \right) - \gamma \nabla^4 \phi\]</div>
<p>where <span class="math">\(\phi\)</span> is a conserved ordered parameter and
<span class="math">\(\sqrt{\gamma}\)</span> represents the width of the interface. In this
example, the Cahn-Hilliard equation is solved using a semi-implicit
spectral scheme with periodic boundary conditions, see <a class="reference external" href="http://dx.doi.org/10.1103/PhysRevE.72.055701">Chang and
Rutenberg</a> for more
details.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span>import pymks

%matplotlib inline
%load_ext autoreload
%autoreload 2

import numpy as np
import matplotlib.pyplot as plt
</pre></div>
</div>
<div class="section" id="modeling-with-mks">
<h3>Modeling with MKS<a class="headerlink" href="#modeling-with-mks" title="Permalink to this headline">¶</a></h3>
<p>In this example the MKS equation will be used to predict microstructure
at the next time step using</p>
<div class="math">
\[p[s, 1] = \sum_{r=0}^{S-1} \alpha[l, r, 1] \sum_{l=0}^{L-1} m[l, s - r, 0] + ...\]</div>
<p>where <span class="math">\(p[s, n + 1]\)</span> is the concentration field at location
<span class="math">\(s\)</span> and at time <span class="math">\(n + 1\)</span>, <span class="math">\(r\)</span> is the convolution dummy
variable and <span class="math">\(l\)</span> indicates the local states varable.
<span class="math">\(\alpha[l, r, n]\)</span> are the influence coefficients and
<span class="math">\(m[l, r, 0]\)</span> the microstructure function given to the model.
<span class="math">\(S\)</span> is the total discretized volume and <span class="math">\(L\)</span> is the total
number of local states <code class="docutils literal"><span class="pre">n_states</span></code> choosen to use.</p>
<p>The model will march forward in time by recursively replacing
discretizing <span class="math">\(p[s, n]\)</span> and substituing it back for
<span class="math">\(m[l, s - r, n]\)</span>.</p>
</div>
</div>
<div class="section" id="calibration-datasets">
<h2>Calibration Datasets<a class="headerlink" href="#calibration-datasets" title="Permalink to this headline">¶</a></h2>
<p>Unlike the elastostatic examples, the microstructure (concentration
field) for this simulation doesn&#8217;t have discrete phases. The
microstructure is a continuous field that can have a range of values
which can change over time, therefore the first order influence
coefficients cannot be calibrated with delta microstructures. Instead, a
large number of simulations with random initial conditions are used to
calibrate the first order influence coefficients using linear
regression.</p>
<p>The function <code class="docutils literal"><span class="pre">make_cahn_hilliard</span></code> from <code class="docutils literal"><span class="pre">pymks.datasets</span></code> provides an
interface to generate calibration datasets for the influence
coefficients. To use <code class="docutils literal"><span class="pre">make_cahn_hilliard</span></code>, we need to set the number
of samples we want to use to calibrate the influence coefficients using
<code class="docutils literal"><span class="pre">n_samples</span></code>, the size of the simulation domain using <code class="docutils literal"><span class="pre">size</span></code> and the
time step using <code class="docutils literal"><span class="pre">dt</span></code>.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pymks</span>
<span class="kn">from</span> <span class="nn">pymks.datasets</span> <span class="kn">import</span> <span class="n">make_cahn_hilliard</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">41</span>
<span class="n">n_samples</span> <span class="o">=</span> <span class="mi">400</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">1e-2</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">99</span><span class="p">)</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_cahn_hilliard</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="n">n_samples</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
</pre></div>
</div>
<p>The function <code class="docutils literal"><span class="pre">make_cahnHilliard</span></code> generates <code class="docutils literal"><span class="pre">n_samples</span></code> number of
random microstructures, <code class="docutils literal"><span class="pre">X</span></code>, and the associated updated
microstructures, <code class="docutils literal"><span class="pre">y</span></code>, after one time step <code class="docutils literal"><span class="pre">y</span></code>. The following cell
plots one of these microstructures along with its update.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pymks.tools</span> <span class="kn">import</span> <span class="n">draw_concentrations</span>

<span class="n">draw_concentrations</span><span class="p">((</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">labels</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Input Concentration&#39;</span><span class="p">,</span> <span class="s1">&#39;Output Concentration&#39;</span><span class="p">))</span>
</pre></div>
</div>
<img alt="../_images/localization_cahn_hilliard_2D_6_0.png" src="../_images/localization_cahn_hilliard_2D_6_0.png" />
</div>
<div class="section" id="calibrate-influence-coefficients">
<h2>Calibrate Influence Coefficients<a class="headerlink" href="#calibrate-influence-coefficients" title="Permalink to this headline">¶</a></h2>
<p>As mentioned above, the microstructures (concentration fields) does not
have discrete phases. This leaves the number of local states in local
state space as a free hyperparameter. In previous work it has been shown
that, as you increase the number of local states, the accuracy of MKS
model increases (see <a class="reference external" href="http://dx.doi.org/10.1016/j.actamat.2010.10.008">Fast et
al.</a>), but, as the
number of local states increases, the difference in accuracy decreases.
Some work needs to be done in order to find the practical number of
local states that we will use.</p>
</div>
<div class="section" id="optimizing-the-number-of-local-states">
<h2>Optimizing the Number of Local States<a class="headerlink" href="#optimizing-the-number-of-local-states" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s split the calibrate dataset into test and training datasets. The
function <code class="docutils literal"><span class="pre">train_test_split</span></code> for the machine learning Python module
<a class="reference external" href="http://scikit-learn.org/stable/">sklearn</a> provides a convenient
interface to do this. 80% of the dataset will be used for training and
the remaining 20% will be used for testing by setting <code class="docutils literal"><span class="pre">test_size</span></code>
equal to 0.2. The state of the random number generator used to make the
split can be set using <code class="docutils literal"><span class="pre">random_state</span></code>.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sklearn</span>
<span class="kn">from</span> <span class="nn">sklearn.cross_validation</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="n">split_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],)</span> <span class="o">+</span> <span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,)</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">split_shape</span><span class="p">),</span> <span class="n">y</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">split_shape</span><span class="p">),</span>
                                                    <span class="n">test_size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>We are now going to calibrate the influence coefficients while varying
the number of local states from 2 up to 20. Each of these models will
then predict the evolution of the concentration fields. Mean square
error will be used to compare the results with the testing dataset to
evaluate how the MKS model&#8217;s performance changes as we change the number
of local states.</p>
<p>First we need to import the class <code class="docutils literal"><span class="pre">MKSLocalizationModel</span></code> from
<code class="docutils literal"><span class="pre">pymks</span></code>.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pymks</span> <span class="kn">import</span> <span class="n">MKSLocalizationModel</span>
<span class="kn">from</span> <span class="nn">pymks.bases</span> <span class="kn">import</span> <span class="n">PrimitiveBasis</span>
</pre></div>
</div>
<p>Next we will calibrate the influence coefficients while varying the
number of local states and compute the mean squared error. The following
demonstrates how to use scikit-learn&#8217;s <code class="docutils literal"><span class="pre">GridSearchCV</span></code> to optimize
<code class="docutils literal"><span class="pre">n_states</span></code> as a hyperparameter. Of course, the best fit is always with
a larger value of <code class="docutils literal"><span class="pre">n_states</span></code>. Increasing this parameter does not
overfit the data.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.grid_search</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>

<span class="n">parameters_to_tune</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n_states&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">)}</span>
<span class="n">p_basis</span> <span class="o">=</span> <span class="n">PrimitiveBasis</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">MKSLocalizationModel</span><span class="p">(</span><span class="n">p_basis</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">gs</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">parameters_to_tune</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">fit_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">)})</span>
<span class="n">gs</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>GridSearchCV(cv=5, error_score=&#39;raise&#39;,
       estimator=MKSLocalizationModel(basis=&lt;pymks.bases.primitive.PrimitiveBasis object at 0x7f2809547990&gt;,
           lstsq_rcond=2.2204460492503131e-12, n_jobs=None,
           n_states=array([0, 1])),
       fit_params={&#39;size&#39;: (41, 41)}, iid=True, n_jobs=1,
       param_grid={&#39;n_states&#39;: array([ 2,  3,  4,  5,  6,  7,  8,  9, 10])},
       pre_dispatch=&#39;2*n_jobs&#39;, refit=True, scoring=None, verbose=0)
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>MKSLocalizationModel(basis=&lt;pymks.bases.primitive.PrimitiveBasis object at 0x7f280cbca850&gt;,
           lstsq_rcond=2.2204460492503131e-12, n_jobs=None, n_states=10)
0.99999908222
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pymks.tools</span> <span class="kn">import</span> <span class="n">draw_gridscores</span>

<span class="n">draw_gridscores</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">grid_scores_</span><span class="p">,</span> <span class="s1">&#39;n_states&#39;</span><span class="p">,</span>
                <span class="n">score_label</span><span class="o">=</span><span class="s1">&#39;R-squared&#39;</span><span class="p">,</span> <span class="n">param_label</span><span class="o">=</span><span class="s1">&#39;L-Number of Local States&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/localization_cahn_hilliard_2D_14_0.png" src="../_images/localization_cahn_hilliard_2D_14_0.png" />
<p>As expected, the accuracy of the MKS model monotonically increases, as
we increase <code class="docutils literal"><span class="pre">n_states</span></code>, but accuracy doesn&#8217;t improve significantly as
<code class="docutils literal"><span class="pre">n_states</span></code> gets larger than signal digits.</p>
<p>In order to save on computation costs, let&#8217;s set (calibrate) the
influence coefficients with <code class="docutils literal"><span class="pre">n_states</span></code> equal to 6, but realize that,
if we need slightly more accuracy, the value can be increased.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">MKSLocalizationModel</span><span class="p">(</span><span class="n">basis</span><span class="o">=</span><span class="n">PrimitiveBasis</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<p>Here are the first 4 influence coefficients.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pymks.tools</span> <span class="kn">import</span> <span class="n">draw_coeff</span>

<span class="n">draw_coeff</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="o">...</span><span class="p">,:</span><span class="mi">4</span><span class="p">])</span>
</pre></div>
</div>
<img alt="../_images/localization_cahn_hilliard_2D_18_0.png" src="../_images/localization_cahn_hilliard_2D_18_0.png" />
</div>
<div class="section" id="predict-microstructure-evolution">
<h2>Predict Microstructure Evolution<a class="headerlink" href="#predict-microstructure-evolution" title="Permalink to this headline">¶</a></h2>
<p>With the calibrated influence coefficients, we are ready to predict the
evolution of a concentration field. In order to do this, we need to have
the Cahn-Hilliard simulation and the MKS model start with the same
initial concentration <code class="docutils literal"><span class="pre">phi0</span></code> and evolve in time. In order to do the
Cahn-Hilliard simulation, we need an instance of the class
<code class="docutils literal"><span class="pre">CahnHilliardSimulation</span></code>.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pymks.datasets.cahn_hilliard_simulation</span> <span class="kn">import</span> <span class="n">CahnHilliardSimulation</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">191</span><span class="p">)</span>

<span class="n">phi0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1e-9</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
<span class="n">ch_sim</span> <span class="o">=</span> <span class="n">CahnHilliardSimulation</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
<span class="n">phi_sim</span> <span class="o">=</span> <span class="n">phi0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">phi_pred</span> <span class="o">=</span> <span class="n">phi0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
<p>In order to move forward in time, we need to feed the concentration back
into the Cahn-Hilliard simulation and the MKS model.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">time_steps</span> <span class="o">=</span> <span class="mi">10</span>

<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">time_steps</span><span class="p">):</span>
    <span class="n">ch_sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">phi_sim</span><span class="p">)</span>
    <span class="n">phi_sim</span> <span class="o">=</span> <span class="n">ch_sim</span><span class="o">.</span><span class="n">response</span>
    <span class="n">phi_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">phi_pred</span><span class="p">)</span>
</pre></div>
</div>
<p>Let&#8217;s take a look at the concentration fields.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pymks.tools</span> <span class="kn">import</span> <span class="n">draw_concentrations_compare</span>

<span class="n">draw_concentrations</span><span class="p">((</span><span class="n">phi_sim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">phi_pred</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">labels</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Simulation&#39;</span><span class="p">,</span> <span class="s1">&#39;MKS&#39;</span><span class="p">))</span>
</pre></div>
</div>
<img alt="../_images/localization_cahn_hilliard_2D_24_0.png" src="../_images/localization_cahn_hilliard_2D_24_0.png" />
<p>The MKS model was able to capture the microstructure evolution with 6
local states.</p>
<div class="section" id="resizing-the-coefficients-to-use-on-larger-systems">
<h3>Resizing the Coefficients to use on Larger Systems<a class="headerlink" href="#resizing-the-coefficients-to-use-on-larger-systems" title="Permalink to this headline">¶</a></h3>
<p>Now let&#8217;s try and predict a larger simulation by resizing the
coefficients and provide a larger initial concentratio field.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">n</span>
<span class="n">model</span><span class="o">.</span><span class="n">resize_coeff</span><span class="p">((</span><span class="n">m</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span>

<span class="n">phi0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1e-9</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span>
<span class="n">phi_sim</span> <span class="o">=</span> <span class="n">phi0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">phi_pred</span> <span class="o">=</span> <span class="n">phi0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
<p>Once again we are going to march forward in time by feeding the
concentration fields back into the Cahn-Hilliard simulation and the MKS
model.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
    <span class="n">ch_sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">phi_sim</span><span class="p">)</span>
    <span class="n">phi_sim</span> <span class="o">=</span> <span class="n">ch_sim</span><span class="o">.</span><span class="n">response</span>
    <span class="n">phi_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">phi_pred</span><span class="p">)</span>
</pre></div>
</div>
<p>Let&#8217;s take a look at the results.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pymks.tools</span> <span class="kn">import</span> <span class="n">draw_concentrations_compare</span>

<span class="n">draw_concentrations_compare</span><span class="p">((</span><span class="n">phi_sim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">phi_pred</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">labels</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Simulation&#39;</span><span class="p">,</span> <span class="s1">&#39;MKS&#39;</span><span class="p">))</span>
</pre></div>
</div>
<img alt="../_images/localization_cahn_hilliard_2D_30_0.png" src="../_images/localization_cahn_hilliard_2D_30_0.png" />
<p>The MKS model with resized influence coefficients was able to reasonably
predict the structure evolution for a larger concentration field.</p>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.5.<br/>
    </p>
  </div>
</footer>
  </body>
</html>